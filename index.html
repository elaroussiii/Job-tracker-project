<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Tracker</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Script de vérification d'authentification et affichage de l'avatar utilisateur -->
    <script>
      // Si l'utilisateur n'est pas marqué comme connecté dans le localStorage,
      // on le redirige vers la page d'authentification.
      if (!localStorage.getItem("isLoggedIn")) {
        window.location.href = "auth.html";
      }

      // Après le chargement du DOM, on met à jour l'avatar avec l'email stocké
      // dans le localStorage (initiale dans l'avatar + email complet en infobulle).
      document.addEventListener("DOMContentLoaded", () => {
        const userAvatar = document.querySelector(".user-avatar");
        const userEmail = localStorage.getItem("userEmail");

        if (userAvatar && userEmail) {
          userAvatar.textContent = userEmail.charAt(0).toUpperCase();
          userAvatar.title = userEmail;
        }
      });
    </script>

    <!-- Barre de navigation supérieure avec logo de l'application et avatar utilisateur -->
    <nav class="navbar">
      <div class="logo">
        <img src="pictures/logo.png" alt="Job Tracker" class="logo-icon" />
        <h1>Job Tracker</h1>
      </div>
      <div class="user-profile">
        <div class="user-avatar">JD</div>
      </div>
    </nav>

    <!-- Conteneur principal de la page -->
    <div class="container">
      <!-- Barre de contrôle : ajout d’une candidature et filtrage par statut -->
      <div class="control-bar">
        <button class="btn-add" id="addApplicationBtn">
          <span>➕</span>
          Add Application
        </button>
        <div class="filter-group">
          <span class="filter-label">Filter by Status:</span>
          <select class="filter-select" id="statusFilter">
            <option value="all">All Applications</option>
            <option value="sent">Sent</option>
            <option value="interview">Interview</option>
            <option value="rejected">Rejected</option>
            <option value="accepted">Accepted</option>
          </select>
        </div>
      </div>

      <!-- Section de recherche d’offres d’emploi via l’API Adzuna -->
      <div class="job-search-bar">
        <h2>Search Jobs (Adzuna)</h2>
        <div class="job-search-fields">
          <input
            type="text"
            id="searchWhat"
            placeholder="Job title (e.g. developer, data analyst)"
          />
          <input
            type="text"
            id="searchWhere"
            placeholder="Location (e.g. Paris, Lyon)"
          />
          <select id="searchContract">
            <option value="">Any contract</option>
            <option value="permanent">Permanent</option>
            <option value="contract">Contract</option>
            <option value="part_time">Part-time</option>
            <option value="internship">Internship</option>
          </select>
          <button id="searchJobsBtn" class="btn-search">Search Jobs</button>
        </div>
      </div>

      <!-- Section d’affichage des résultats de la recherche d’emplois -->
      <div class="job-results-container">
        <h3>Job Results</h3>
        <div id="jobResults" class="job-results-grid">
          <!-- Les offres retournées par Adzuna seront injectées ici en JavaScript -->
        </div>
      </div>

      <!-- Zone de statistiques globales sur les candidatures -->
      <div class="stats-grid">
        <div class="stat-card stat-sent">
          <div class="stat-number" id="statSent">8</div>
          <div class="stat-label">Applications Sent</div>
        </div>
        <div class="stat-card stat-interview">
          <div class="stat-number" id="statInterview">3</div>
          <div class="stat-label">Interviews Scheduled</div>
        </div>
        <div class="stat-card stat-rejected">
          <div class="stat-number" id="statRejected">2</div>
          <div class="stat-label">Rejected</div>
        </div>
        <div class="stat-card stat-accepted">
          <div class="stat-number" id="statAccepted">1</div>
          <div class="stat-label">Accepted</div>
        </div>
      </div>

      <!-- Grille des candidatures : cartes générées dynamiquement par script.js -->
      <div class="applications-grid" id="applicationsGrid"></div>
    </div>

    <!-- Fenêtre modale pour ajouter ou éditer une candidature -->
    <div class="modal" id="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">Add New Application</h2>
          <button class="close-btn" id="closeModalBtn">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Formulaire de saisie des informations de candidature -->
          <form id="applicationForm">
            <div class="form-group">
              <label for="companyInput">Company Name *</label>
              <input
                id="companyInput"
                type="text"
                placeholder="e.g., Google"
                required
              />
            </div>
            <div class="form-group">
              <label for="positionInput">Position *</label>
              <input
                id="positionInput"
                type="text"
                placeholder="e.g., Software Engineer"
                required
              />
            </div>
            <div class="form-group">
              <label for="contractInput">Contract Type *</label>
              <select id="contractInput" required>
                <option value="">Select...</option>
                <option value="Internship">Internship</option>
                <option value="CDI">CDI</option>
                <option value="CDD">CDD</option>
                <option value="Freelance">Freelance</option>
              </select>
            </div>
            <div class="form-group">
              <label for="statusInput">Status *</label>
              <select id="statusInput" required>
                <option value="sent">Sent</option>
                <option value="interview">Interview</option>
                <option value="rejected">Rejected</option>
                <option value="accepted">Accepted</option>
              </select>
            </div>
            <div class="form-group">
              <label for="applyDateInput">Apply Date *</label>
              <input id="applyDateInput" type="date" required />
            </div>
            <div class="form-group">
              <label for="interviewDateInput">Interview Date</label>
              <input id="interviewDateInput" type="date" />
            </div>
            <div class="form-group">
              <label for="offerLinkInput">Offer Link</label>
              <input id="offerLinkInput" type="url" placeholder="https://..." />
            </div>
            <div class="form-group">
              <label for="notesInput">Notes</label>
              <textarea
                id="notesInput"
                placeholder="Notes, détails, suivi..."
              ></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="btn-cancel" id="cancelModalBtn">
                Cancel
              </button>
              <button type="submit" class="btn-submit">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Script principal gérant la logique de l’application (candidatures, recherche, etc.) -->
    <script src="script.js"></script>
  </body>
</html>
